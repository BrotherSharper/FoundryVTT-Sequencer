{"_id":"5TqGfqIsnfsWeB2N","name":"Sequencer-Spell-5e-Generic-Magic-Effect","type":"script","author":"yjDURLhSy6ZUAhtN","img":"icons/svg/dice-target.svg","scope":"global","command":"// Requires the ____PAID____ JB2A module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of any spell in the \"On Use Macro\" field\n\nconst tokenD = canvas.tokens.get(args[0].tokenId);\nnew Sequence()\n    .effect()\n        .baseFolder(\"modules/jb2a_patreon/Library/Generic/Template/Circle/OutPulse\")\n        .file(\"OutPulse_02_Regular_{{color}}_Burst_600x600.webm\")\n        .atLocation(tokenD)\n        .JB2A()\n        .scale(0.3)\n        .setMustache({\n            \"color\": () => {\n                return ['BlueWhite', 'GreenOrange', 'PurplePink', 'TealYellow'][Math.floor(Math.random() * 4)]\n            }\n        })\n    .play()","folder":null,"sort":0,"permission":{"default":0,"yjDURLhSy6ZUAhtN":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.zW1mk5Uk00qebTRz"}}}
{"_id":"7DD7e1ksD1hgFk2Y","name":"Sequencer-VFX-Chain-Lightning-Complex","type":"script","author":"yjDURLhSy6ZUAhtN","img":"icons/svg/dice-target.svg","scope":"global","command":"// Requires the Jack Kerouac's Animated Spell Effects: Cartoon module\n// Select a token, then target a set of tokens in any order, and run this macro.\n\nlet current_target = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nlet tokenOrder = [];\nfor(let i = 0; i < targets.length; i++){\n    let potential_targets = targets.filter(item => tokenOrder.indexOf(item) === -1);\n    let from = tokenOrder[tokenOrder.length-1] ?? current_target;\n    let closest = potential_targets.reduce((a, b) => findClosestTo(from, a, b));\n    tokenOrder.push(closest);\n}\n\nlet origin = current_target;\n\nlet sequence = new Sequence(); // Create a new sequence\n\nfor(let target of tokenOrder){\n    sequence.effect()\n        .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/electricity/lightning_bolt_RECTANGLE_03.webm\")\n        .atLocation(origin) // Going from origin\n        .reachTowards(target) // To the current loop's target\n    sequence.effect()\n        .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/electricity/electric_ball_CIRCLE_06.webm\")\n        .atLocation(target) // Static on the target\n        .gridSize(100)\n        .scale(0.5)\n        .wait(10) // Slight delay between each arc\n    origin = target; // Then make current target the new origin\n}\n\nsequence.play()\n\nfunction findClosestTo(from, a, b){\n    let a_dist = canvas.grid.measureDistance(from, a);\n    let b_dist = canvas.grid.measureDistance(from, b);\n    return a_dist < b_dist ? a : b;\n}","folder":null,"sort":0,"permission":{"default":0,"yjDURLhSy6ZUAhtN":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.1aKkG9IYsSN0M9OK"}}}
{"_id":"FWOFX2aA6MbsCa0z","name":"Sequencer-Spell-5e-Sword-Burst","type":"script","author":"yjDURLhSy6ZUAhtN","img":"icons/svg/dice-target.svg","scope":"global","command":"// Requires the Jack Kerouac's Animated Spell Effects: Cartoon module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of any spell in the \"On Use Macro\" field\n\nlet tokenD = canvas.tokens.get(args[0].tokenId);\nlet sequence = new Sequence()\n    .effect()\n        .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/magic/magic_sphere_1token_SQUARE.webm\")\n        .atLocation(tokenD)\n        .scale(2.5)\n        .gridSize(200)\n        .center()\n    .play()","folder":null,"sort":0,"permission":{"default":0,"yjDURLhSy6ZUAhtN":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.dxxGCIwWWBa9RQvB"}}}
{"_id":"NLK8RedDPfkZV6G8","name":"Sequencer-Spell-5e-Acid-Splash","type":"script","author":"yjDURLhSy6ZUAhtN","img":"icons/svg/dice-target.svg","scope":"global","command":"// Requires the Jack Kerouac's Animated Spell Effects: Cartoon module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of the Acid Splash spell in the \"On Use Macro\" field\n\nlet tokenD = canvas.tokens.get(args[0].tokenId);\nlet targets = Array.from(args[0].failedSaves);\n\nif(targets.length){\n    new Sequence()\n        .effect()\n            .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/water/acid_splash_CIRCLE_01.webm\")\n            .atLocation(targets[0])\n            .scale(0.3, 0.6)\n            .center()\n            .randomRotation()\n        .effect()\n            .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/water/acid_splash_CIRCLE_01.webm\")\n            .atLocation(targets[1] ?? false)\n            .scale(0.3, 0.6)\n            .center()\n            .randomRotation()\n            .delay(300)\n            .playIf(targets.length === 2)\n        .play() \n}","folder":null,"sort":0,"permission":{"default":0,"yjDURLhSy6ZUAhtN":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.K2iB1URLuK9ZxYsD"}}}
{"_id":"SkFF9pI8UZeTdylz","name":"Sequencer-Spell-5e-Misty-Step","type":"script","author":"yjDURLhSy6ZUAhtN","img":"icons/svg/dice-target.svg","scope":"global","command":"// Requires the JB2A module - if you're using their free version, change the path to point to the right location\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of the Misty Step spell in the \"On Use Macro\" field\n\nlet baseFolder = \"modules/jb2a_patreon/Library/2nd_Level/Misty_Step\";\n\nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\nconst target = canvas.tokens.get(lastArg.tokenId) || token;\n\nlet range = MeasuredTemplate.create({\n    t: \"circle\",\n    user: game.user._id,\n    x: target.x + canvas.grid.size / 2,\n    y: target.y + canvas.grid.size / 2,\n    direction: 0,\n    distance: 30,\n    borderColor: \"#FF0000\",\n    flags: {\n        world: {\n            MistyStep: {\n                ActorId: tactor.id\n            }\n        }\n    }\n});\n\nrange.then(result => {\n\n    let templateData = {\n        t: \"circle\",\n        user: game.user._id,\n        distance: 2.5,\n        direction: 45,\n        x: 0,\n        y: 0,\n        fillColor: game.user.color,\n        flags: {\n            world: {\n                MistyStep: {\n                    ActorId: tactor.id\n                }\n            }\n        }\n    };\n\n\n    Hooks.once(\"createMeasuredTemplate\", deleteTemplatesAndMove);\n\n    let template = new game.dnd5e.canvas.AbilityTemplate(templateData);\n    template.actorSheet = tactor.sheet;\n    template.drawPreview();\n\n    async function deleteTemplatesAndMove(scene, template) {\n\n        let removeTemplates = canvas.templates.placeables.filter(i => i.data.flags.world?.MistyStep?.ActorId === tactor.id);\n        await canvas.templates.deleteMany([removeTemplates[0].id, removeTemplates[1].id]);\n        await tactor.deleteEmbeddedEntity(\"ActiveEffect\", lastArg.effectId); \n\n        new Sequence()\n            .effect()\n                .file(\"MistyStep_01_Regular_Blue_400x400.webm\")\n                .baseFolder(baseFolder)\n                .atLocation(target)\n                .JB2A()\n                .scale(0.6)\n                .randomRotation()\n            .wait(750)\n            .then(async () => {\n                await target.update({\n                    x: template.x - (canvas.grid.size * 0.5),\n                    y: template.y - (canvas.grid.size * 0.5),\n                    hidden: true\n                }, { animate: false });\n            }, true)\n            .effect()\n                .file(\"MistyStep_02_Regular_Blue_400x400.webm\")\n                .baseFolder(baseFolder)\n                .atLocation(template)\n                .JB2A()\n                .scale(0.6)\n                .randomRotation()\n            .wait(1500)\n            .then(async () => {\n                await target.update({\n                    hidden: false\n                }, { animate: false });\n            }, true)\n            .play();\n\n        \n    };\n});","folder":null,"sort":0,"permission":{"default":0,"yjDURLhSy6ZUAhtN":3},"flags":{"furnace":{"runAsGM":false},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.0nao3mhIvaNzxmgx"}}}
{"_id":"WUowOTtsJcgP2NbU","name":"Sequencer-Spell-5e-Chain-Lightning","type":"script","author":"yjDURLhSy6ZUAhtN","img":"icons/svg/dice-target.svg","scope":"global","command":"// Requires the Jack Kerouac's Animated Spell Effects: Cartoon module\n// Requires Advanced Macros \n// Requires MidiQOL with Workflow -> Add macro to call on use, and merge saves and damage to item cards\n// Then add this macro's name to the bottom of the Chain Lightning spell in the \"On Use Macro\" field\n\nconst actorD = game.actors.get(args[0].actor._id);\nconst tokenD = canvas.tokens.get(args[0].tokenId);\nconst itemD = actorD.items.getName(args[0].item.name);\nconst spellLevel = args[0].spellLevel ? Number(args[0].spellLevel) : 6;\nconst targetsToJumpTo = 3 + (spellLevel-6);\nconst spellSaveDC = args[0].actor.data.attributes.spelldc;\n\nasync function wait(ms) {\n    return new Promise((resolve) => {\n        setTimeout(resolve, ms);\n    });\n}\n\nconsole.log(args)\n\nfunction addTokenToText(token, roll, dc){\n\n    return `<div class=\"midi-qol-flex-container\">\n      <div class=\"midi-qol-target-npc-GM midi-qol-target-name\" id=\"${token.id}\"> ${token.name}</div>\n      <div class=\"midi-qol-target-npc-Player midi-qol-target-name\" id=\"${token.id}\" style=\"display: none;\"> ${token.name}</div>\n      <div>\n         ${roll >= dc ? \"succeeds\" : \"fails\"} with \n        ${roll}\n        \n      </div>\n      <div><img src=\"${token.data.img}\" height=\"30\" style=\"border:0px\"></div>\n    </div>`;\n\n}\n\nasync function main(){\n\n    const chatMessage = await game.messages.get(args[0].itemCardId);\n    let chatMessageContent = await duplicate(chatMessage.data.content);\n\n    const targetToken = canvas.tokens.get(args[0].hitTargets[0]._id);\n\n    let enemies = canvas.tokens.placeables.filter(function(target){\n        return target.actor.data.data.attributes.hp.value > 0\n            && canvas.grid.measureDistance(targetToken, target) <= 32.5\n            && target !== targetToken\n            && target !== tokenD\n    });\n\n    let targetList = \"\";\n\n    for (let target of enemies) {\n        targetList += `<tr class='chainLightningToken' id='${target.id}'>\n            <td><img src=\"${target.data.img}\" width=\"30\" height=\"30\" style=\"border:0px\"> - ${target.name}</td>\n            <td><input type=\"checkbox\" class='target' name=\"${target.id}\"></td>\n        </tr>`;\n    }\n\n    let the_content = `\n        <p>Your Chain Lightning can jump to <b>${targetsToJumpTo}</b> targets.</p>\n        <form class=\"flexcol\">\n            <table width=\"100%\">\n                <tbody>\n                    <tr><th>Target</th>\n                    <th>Jump to</th>\n                    </tr>${targetList}\n                </tbody>\n            </table>\n        </form>`;\n\n    new Dialog({\n        title: \"Chain Lightning\",\n        content: the_content,\n        buttons: {\n            one: {\n                label: \"Damage\", callback: async (html) => {\n\n                    $(\".chainLightningToken\").off(\"mouseenter\").off(\"mouseleave\");\n                    let targets = html.find('input.target').filter((index, elem) => {\n                        return $(elem).is(\":checked\")\n                    });\n                    let damageRoll = new Roll(`${args[0].damageTotal}`).roll();\n\n                    let targetTokens = new Set();\n                    let saves = new Set();\n\n                    let newChatmessageContent = $(chatMessageContent);\n\n                    let chains = 0;\n                    for(let target of targets){\n                        chains++;\n                        if(chains > targetsToJumpTo) break;\n\n                        let enemyToken = canvas.tokens.get(target.name)\n\n                        let save = new Roll(\"1d20+@mod\",{mod: enemyToken.actor.data.data.abilities.dex.save}).roll().total;\n\n                        targetTokens.add(enemyToken)\n                        if(save >= spellSaveDC){\n                            saves.add(enemyToken)\n                        }\n\n                        newChatmessageContent.find(\".midi-qol-nobox.midi-qol-saves-display\").append(\n                            $(addTokenToText(enemyToken, save, spellSaveDC))\n                        );\n\n                    }\n\n                    await chatMessage.update({ content: newChatmessageContent.prop('outerHTML') });\n                    await ui.chat.scrollBottom();\n\n                    MidiQOL.applyTokenDamage(\n                        [{ damage: args[0].damageTotal, type: \"lightning\" }],\n                        damageRoll.total,\n                        targetTokens,\n                        itemD,\n                        saves\n                    )\n\n                    let sequence = new Sequence()\n                        .effect()\n                            .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/electricity/lightning_bolt_RECTANGLE_03.webm\")\n                            .atLocation(tokenD) // Going from origin\n                            .reachTowards(targetToken) // To the current loop's target\n                        .effect()\n                            .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/electricity/electric_ball_CIRCLE_06.webm\")\n                            .atLocation(targetToken) // Static on the target\n                            .gridSize(100)\n                            .scale(0.5)\n                        .wait(150) // Slight delay between each arc\n\n                    for(let target of targetTokens){\n                        sequence\n                            .effect()\n                                .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/electricity/lightning_bolt_RECTANGLE_03.webm\")\n                                .atLocation(targetToken) // Going from origin\n                                .reachTowards(target) // To the current loop's target\n                            .effect()\n                                .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/electricity/electric_ball_CIRCLE_06.webm\")\n                                .atLocation(target) // Static on the target\n                                .gridSize(100)\n                                .scale(0.5)\n                    }\n\n                    sequence.play()\n\n                }\n            }\n        }\n    }).render(true);\n\n    await wait(100);\n\n    $(\".chainLightningToken\").on(\"mouseenter\", function(e){\n        let token = canvas.tokens.get($(this).attr('id'));\n        token._onHoverIn(e);\n    }).on(\"mouseleave\", function(e){\n        let token = canvas.tokens.get($(this).attr('id'));\n        token._onHoverOut(e);\n    });\n\n}\n\nmain()","folder":null,"sort":0,"permission":{"default":0,"yjDURLhSy6ZUAhtN":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.u6QVVpCXkQ8ez7jm"}}}
{"_id":"ZQ1tGcP5ljGDRywu","name":"Sequencer-VFX-Chain-Lightning-Simple","type":"script","author":"yjDURLhSy6ZUAhtN","img":"icons/svg/dice-target.svg","scope":"global","command":"// Requires the Jack Kerouac's Animated Spell Effects: Cartoon module\n// Select a token, then target a set of tokens, and run this macro\n\nlet current_target = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nlet origin = current_target;\n\nlet sequence = new Sequence(); // Create a new sequence\nfor(let target of targets){\n    sequence.effect()\n        .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/electricity/lightning_bolt_RECTANGLE_03.webm\")\n        .atLocation(origin) // Going from origin\n        .reachTowards(target) // To the current loop's target\n    .effect()\n        .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/electricity/electric_ball_CIRCLE_06.webm\")\n        .atLocation(target) // Static on the target\n        .gridSize(100)\n        .scale(0.5)\n        .wait(10) // Slight delay between each arc\n    origin = target; // Then make current target the new origin\n}\n\nsequence.play()","folder":null,"sort":0,"permission":{"default":0,"yjDURLhSy6ZUAhtN":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.8SJxOa7Y4naxAAP1"}}}
{"_id":"o7gL16PlOj1iyXue","name":"Sequencer-Spell-5e-Faerie-Fire","type":"script","author":"yjDURLhSy6ZUAhtN","img":"icons/svg/dice-target.svg","scope":"global","command":"// Requires the JB2A module - if you're using their free version, change the path to point to the right location\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of the Faerie Fire spell in the \"On Use Macro\" field\n\nlet template = canvas.templates.placeables[canvas.templates.placeables.length-1];\n\nif(template){\n    new Sequence()\n        .effect()\n            .baseFolder(\"modules/jb2a_patreon/Library/Generic/Fireflies\")\n            .file(\"Fireflies_01_Green_Few01_400x400.webm\")\n            .atLocation(template)\n            .JB2A()\n        .effect()\n            .baseFolder(\"modules/jb2a_patreon/Library/Generic/Fireflies\")\n            .file(\"Fireflies_01_Green_Few02_400x400.webm\")\n            .atLocation(template )\n            .JB2A()\n        .effect()\n            .baseFolder(\"modules/jb2a_patreon/Library/Generic/Fireflies\")\n            .file(\"Fireflies_01_Green_Many01_400x400.webm\")\n            .atLocation(template)\n            .JB2A()\n        .effect()\n            .baseFolder(\"modules/jb2a_patreon/Library/Generic/Fireflies\")\n            .file(\"Fireflies_01_Green_Many02_400x400.webm\")\n            .atLocation(template)\n            .JB2A()\n            .waitUntilFinished()\n        .then(() => {\n            canvas.templates.deleteMany(template.id)\n        })\n        .play()\n\n}","folder":null,"sort":0,"permission":{"default":0,"yjDURLhSy6ZUAhtN":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.Ci4ls0VomA950hYI"}}}
{"_id":"wEn9oXtvJXYQjfaK","name":"Sequencer-Spell-5e-Generic-Healing","type":"script","author":"yjDURLhSy6ZUAhtN","img":"icons/svg/dice-target.svg","scope":"global","command":"// Requires the JB2A module - if you're using their free version, change the path to point to the right location\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of any spell in the \"On Use Macro\" field\n\n\n\nfor(let target of args[0].targets){\n    new Sequence()\n        .effect()\n            .atLocation(target)\n            .JB2A()\n            .baseFolder(\"modules/jb2a_patreon/Library/Generic/Healing\")\n            .file(\"HealingAbility_01_Green_200x200.webm\")\n        .play()\n}","folder":null,"sort":0,"permission":{"default":0,"yjDURLhSy6ZUAhtN":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.rTXQknjILCNabjxF"}}}
